<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Book Consultation - ConsultHub</title>
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>
<body>
    <nav class="navbar">
        <div class="nav-container">
            <div class="logo">
                <i class="fas fa-handshake"></i>
                <h1>ConsultHub</h1>
            </div>
            <ul class="nav-menu">
                <li><a href="index.html" class="nav-link">Home</a></li>
                <li><a href="client-dashboard.html" class="nav-link">Dashboard</a></li>
                <li><a href="#" class="nav-link btn-register" onclick="logout()">Logout</a></li>
            </ul>
            <div class="hamburger">
                <span class="bar"></span>
                <span class="bar"></span>
                <span class="bar"></span>
            </div>
        </div>
    </nav>

    <div class="dashboard">
        <div class="dashboard-header">
            <h2>Book Consultation</h2>
            <p>Select your preferred date and time</p>
        </div>

        <div class="booking-container">
            <div class="booking-summary">
                <h3>Consultation Details</h3>
                <div id="consultantInfo">
                    <!-- Consultant info will be populated by JavaScript -->
                </div>
            </div>

            <div class="calendar">
                <div class="calendar-header">
                    <h3>Select Date</h3>
                    <div class="month-nav">
                        <button onclick="changeMonth(-1)"><i class="fas fa-chevron-left"></i></button>
                        <span id="currentMonth">January 2024</span>
                        <button onclick="changeMonth(1)"><i class="fas fa-chevron-right"></i></button>
                    </div>
                </div>
                <div class="calendar-grid" id="calendarGrid">
                    <!-- Calendar will be generated by JavaScript -->
                </div>
            </div>

            <div class="time-selection">
                <h3>Select Time</h3>
                <div class="time-slots" id="timeSlots">
                    <!-- Time slots will be populated by JavaScript -->
                </div>
            </div>

            <div class="booking-form">
                <h3>Final Details</h3>
                <form id="bookingForm" onsubmit="confirmBooking(event)">
                    <div class="form-group">
                        <label for="bookingNotes">Notes for Consultant (Optional)</label>
                        <textarea id="bookingNotes" rows="3" placeholder="Any specific topics or questions you'd like to discuss..."></textarea>
                    </div>
                    <div class="form-group">
                        <label for="consultationDuration">Duration</label>
                        <select id="consultationDuration">
                            <option value="30">30 minutes ($75)</option>
                            <option value="60" selected>60 minutes ($150)</option>
                            <option value="90">90 minutes ($210)</option>
                            <option value="120">120 minutes ($280)</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Payment Method</label>
                        <div class="payment-methods">
                            <label>
                                <input type="radio" name="paymentMethod" value="card" checked>
                                <i class="fas fa-credit-card"></i> Credit/Debit Card
                            </label>
                            <label>
                                <input type="radio" name="paymentMethod" value="paypal">
                                <i class="fab fa-paypal"></i> PayPal
                            </label>
                            <label>
                                <input type="radio" name="paymentMethod" value="bank">
                                <i class="fas fa-university"></i> Bank Transfer
                            </label>
                        </div>
                    </div>
                    <div class="price-summary">
                        <div class="price-item">
                            <span>Consultation Fee</span>
                            <span id="consultationFee">$150.00</span>
                        </div>
                        <div class="price-item">
                            <span>Platform Fee</span>
                            <span>$15.00</span>
                        </div>
                        <div class="price-total">
                            <span>Total Amount</span>
                            <span id="totalAmount">$165.00</span>
                        </div>
                    </div>
                    <button type="submit" class="btn-primary btn-block">
                        <i class="fas fa-lock"></i> Confirm & Pay Now
                    </button>
                </form>
            </div>
        </div>
    </div>

    <script>
        let selectedConsultant = null;
        let selectedDate = null;
        let selectedTime = null;
        let currentMonth = 0; // 0 = current month

        document.addEventListener('DOMContentLoaded', function() {
            const user = JSON.parse(localStorage.getItem('currentUser'));
            if (!user) {
                window.location.href = 'index.html';
                return;
            }

            // Get consultant from session storage
            const consultantData = sessionStorage.getItem('selectedConsultant');
            if (!consultantData) {
                window.location.href = 'index.html';
                return;
            }

            selectedConsultant = JSON.parse(consultantData);
            displayConsultantInfo();
            generateCalendar();
            generateTimeSlots();

            // Update price when duration changes
            document.getElementById('consultationDuration').addEventListener('change', updatePrice);

            // Initialize hamburger menu
            const hamburger = document.querySelector('.hamburger');
            const navMenu = document.querySelector('.nav-menu');
            
            hamburger.addEventListener('click', () => {
                hamburger.classList.toggle('active');
                navMenu.classList.toggle('active');
            });
        });

        function displayConsultantInfo() {
            const container = document.getElementById('consultantInfo');
            container.innerHTML = `
                <div class="consultant-card-mini">
                    <h4>${selectedConsultant.name}</h4>
                    <p>${selectedConsultant.description}</p>
                    <div class="consultant-details">
                        <span><i class="fas fa-star"></i> ${selectedConsultant.rating.toFixed(1)} Rating</span>
                        <span><i class="fas fa-clock"></i> ${selectedConsultant.experience} years experience</span>
                        <span><i class="fas fa-money-bill-wave"></i> $${selectedConsultant.rate}/hour</span>
                    </div>
                </div>
            `;
        }

        function generateCalendar() {
            const calendarGrid = document.getElementById('calendarGrid');
            const monthNames = ['January', 'February', 'March', 'April', 'May', 'June', 
                               'July', 'August', 'September', 'October', 'November', 'December'];
            
            const today = new Date();
            const currentDate = new Date(today.getFullYear(), today.getMonth() + currentMonth, 1);
            
            // Update month display
            document.getElementById('currentMonth').textContent = 
                `${monthNames[currentDate.getMonth()]} ${currentDate.getFullYear()}`;
            
            // Generate calendar days
            calendarGrid.innerHTML = '';
            
            // Add day headers
            const days = ['Sun', 'Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat'];
            days.forEach(day => {
                const dayHeader = document.createElement('div');
                dayHeader.className = 'calendar-day-header';
                dayHeader.textContent = day;
                calendarGrid.appendChild(dayHeader);
            });
            
            // Get first day of month
            const firstDay = new Date(currentDate.getFullYear(), currentDate.getMonth(), 1).getDay();
            
            // Add empty cells for days before first day of month
            for (let i = 0; i < firstDay; i++) {
                const emptyCell = document.createElement('div');
                emptyCell.className = 'calendar-day empty';
                calendarGrid.appendChild(emptyCell);
            }
            
            // Get days in month
            const daysInMonth = new Date(currentDate.getFullYear(), currentDate.getMonth() + 1, 0).getDate();
            
            // Add days of month
            for (let day = 1; day <= daysInMonth; day++) {
                const dayCell = document.createElement('div');
                dayCell.className = 'calendar-day';
                dayCell.textContent = day;
                
                const dateStr = `${currentDate.getFullYear()}-${(currentDate.getMonth() + 1).toString().padStart(2, '0')}-${day.toString().padStart(2, '0')}`;
                
                // Check if date is in consultant's availability
                if (selectedConsultant.availability.includes(dateStr)) {
                    dayCell.classList.add('available');
                    dayCell.onclick = () => selectDate(dateStr, dayCell);
                } else {
                    dayCell.classList.add('unavailable');
                }
                
                // Highlight today
                if (currentMonth === 0 && day === today.getDate() && 
                    currentDate.getMonth() === today.getMonth()) {
                    dayCell.classList.add('today');
                }
                
                calendarGrid.appendChild(dayCell);
            }
        }

        function changeMonth(delta) {
            currentMonth += delta;
            generateCalendar();
        }

        function selectDate(date, element) {
            // Remove selection from all days
            document.querySelectorAll('.calendar-day').forEach(day => {
                day.classList.remove('selected');
            });
            
            // Add selection to clicked day
            element.classList.add('selected');
            selectedDate = date;
            
            // Generate time slots for selected date
            generateTimeSlots();
        }

        function generateTimeSlots() {
            const timeSlots = document.getElementById('timeSlots');
            timeSlots.innerHTML = '';
            
            if (!selectedDate) {
                timeSlots.innerHTML = '<p>Please select a date first</p>';
                return;
            }
            
            // Generate time slots (9 AM to 5 PM)
            const slots = [];
            for (let hour = 9; hour <= 17; hour++) {
                slots.push(`${hour.toString().padStart(2, '0')}:00`);
                if (hour < 17) {
                    slots.push(`${hour.toString().padStart(2, '0')}:30`);
                }
            }
            
            slots.forEach(slot => {
                const slotElement = document.createElement('div');
                slotElement.className = 'time-slot';
                slotElement.textContent = slot;
                slotElement.onclick = () => selectTime(slot, slotElement);
                
                // Randomly mark some slots as booked (for demo)
                if (Math.random() < 0.3) {
                    slotElement.classList.add('booked');
                    slotElement.title = 'Already booked';
                } else {
                    slotElement.classList.add('available');
                }
                
                timeSlots.appendChild(slotElement);
            });
        }

        function selectTime(time, element) {
            if (element.classList.contains('booked')) {
                alert('This time slot is already booked. Please choose another.');
                return;
            }
            
            // Remove selection from all time slots
            document.querySelectorAll('.time-slot').forEach(slot => {
                slot.classList.remove('selected');
            });
            
            // Add selection to clicked slot
            element.classList.add('selected');
            selectedTime = time;
        }

        function updatePrice() {
            const duration = parseInt(document.getElementById('consultationDuration').value);
            const hourlyRate = selectedConsultant.rate;
            const consultationFee = (hourlyRate * duration) / 60;
            const platformFee = consultationFee * 0.1; // 10% platform fee
            const total = consultationFee + platformFee;
            
            document.getElementById('consultationFee').textContent = `$${consultationFee.toFixed(2)}`;
            document.getElementById('totalAmount').textContent = `$${total.toFixed(2)}`;
        }

        function confirmBooking(event) {
            event.preventDefault();
            
            if (!selectedDate || !selectedTime) {
                alert('Please select a date and time for your consultation.');
                return;
            }
            
            const duration = document.getElementById('consultationDuration').value;
            const notes = document.getElementById('bookingNotes').value;
            const paymentMethod = document.querySelector('input[name="paymentMethod"]:checked').value;
            
            // Simulate payment processing
            if (confirm(`Confirm booking with ${selectedConsultant.name} on ${selectedDate} at ${selectedTime}?`)) {
                alert('Payment successful! Consultation booked. You will receive a confirmation email shortly.');
                
                // Store booking in local storage (simulated)
                const booking = {
                    id: Date.now(),
                    consultantId: selectedConsultant.id,
                    consultantName: selectedConsultant.name,
                    clientName: JSON.parse(localStorage.getItem('currentUser')).name,
                    date: selectedDate,
                    time: selectedTime,
                    duration: duration,
                    notes: notes,
                    status: 'confirmed',
                    createdAt: new Date().toISOString()
                };
                
                // Save to local storage (simulated database)
                const bookings = JSON.parse(localStorage.getItem('bookings') || '[]');
                bookings.push(booking);
                localStorage.setItem('bookings', JSON.stringify(bookings));
                
                // Redirect to dashboard
                window.location.href = 'client-dashboard.html';
            }
        }

        function logout() {
            localStorage.removeItem('currentUser');
            window.location.href = 'index.html';
        }
    </script>

    <style>
        .booking-container {
            max-width: 1200px;
            margin: 0 auto;
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 2rem;
        }

        .consultant-card-mini {
            background: white;
            padding: 1.5rem;
            border-radius: 1rem;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        .consultant-details {
            display: flex;
            flex-wrap: wrap;
            gap: 1rem;
            margin-top: 1rem;
            font-size: 0.9rem;
        }

        .consultant-details span {
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .calendar-day-header {
            text-align: center;
            font-weight: 600;
            padding: 0.5rem;
            background-color: #f3f4f6;
            border-radius: 0.5rem;
        }

        .calendar-day {
            text-align: center;
            padding: 0.75rem;
            border-radius: 0.5rem;
            cursor: pointer;
            transition: all 0.3s;
        }

        .calendar-day.available {
            background-color: #d1fae5;
            color: #065f46;
        }

        .calendar-day.available:hover {
            background-color: #a7f3d0;
        }

        .calendar-day.unavailable {
            background-color: #f3f4f6;
            color: #9ca3af;
            cursor: not-allowed;
        }

        .calendar-day.selected {
            background-color: var(--primary-color);
            color: white;
        }

        .calendar-day.today {
            border: 2px solid var(--primary-color);
        }

        .time-slot {
            padding: 0.75rem;
            text-align: center;
            border-radius: 0.5rem;
            cursor: pointer;
            transition: all 0.3s;
        }

        .time-slot.available {
            background-color: #dbeafe;
            color: #1e40af;
        }

        .time-slot.available:hover {
            background-color: #bfdbfe;
        }

        .time-slot.booked {
            background-color: #f3f4f6;
            color: #9ca3af;
            cursor: not-allowed;
        }

        .time-slot.selected {
            background-color: var(--primary-color);
            color: white;
        }

        .payment-methods {
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
        }

        .payment-methods label {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.75rem;
            border: 1px solid #d1d5db;
            border-radius: 0.5rem;
            cursor: pointer;
        }

        .payment-methods label:hover {
            background-color: #f3f4f6;
        }

        .price-summary {
            background-color: #f9fafb;
            padding: 1.5rem;
            border-radius: 0.5rem;
            margin: 1.5rem 0;
        }

        .price-item {
            display: flex;
            justify-content: space-between;
            margin-bottom: 0.5rem;
        }

        .price-total {
            display: flex;
            justify-content: space-between;
            font-size: 1.2rem;
            font-weight: 600;
            margin-top: 1rem;
            padding-top: 1rem;
            border-top: 2px solid #d1d5db;
        }

        .btn-block {
            width: 100%;
            padding: 1rem;
            font-size: 1.1rem;
        }

        .month-nav {
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .month-nav button {
            background: none;
            border: none;
            cursor: pointer;
            padding: 0.5rem;
            border-radius: 0.5rem;
        }

        .month-nav button:hover {
            background-color: #f3f4f6;
        }
    </style>
</body>
</html>